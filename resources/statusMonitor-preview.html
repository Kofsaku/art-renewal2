<!DOCTYPE html>
<html
	data-bs-theme="light">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="_csrf"/>
	<meta name="_csrf_header"/>
	<link rel="stylesheet" href="/resources/static/css/common.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<title>TRIDENT</title>
	<script type="text/javascript" src="/resources/static/js/jquery/3.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="/resources/static/js/common.js"></script>
	<script type="text/javascript" src="/resources/static/js/popper.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<title>ステータスモニター</title>
<style>
        /* ---- ゲートカード（ベース = 32件表示） ---- */
        .gate-card {
            border: 2px solid var(--td-border);
            border-radius: 6px;
            padding: 4px 6px;
            background: var(--td-card-bg);
            display: flex;
            flex-direction: row;
            align-items: stretch;
            position: relative;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .gate-card:hover {
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        .gate-card.status-normal  { border-color: #28a745; }
        .gate-card.status-warning { border-color: #e07b00; }
        .gate-card.status-error   { border-color: #dc3545; }
        .gate-card.status-offline {
            border-color: #6c757d;
        }
        .gate-card.status-offline::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(140, 145, 150, 0.55);
            border-radius: 4px;
            pointer-events: none;
        }

        .gate-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 68px;
            margin-right: 6px;
        }
        .gate-number {
            font-weight: bold;
            font-size: 0.72em;
            margin-bottom: 2px;
            color: #495057;
            line-height: 1.2;
            text-align: center;
            word-break: break-all;
        }
        .gate-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.15);
        }
        .indicator-normal  { background: #28a745; }
        .indicator-warning { background: #e07b00; }
        .indicator-error   { background: #dc3545; }
        .indicator-offline { background: #6c757d; }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            flex: 1;
            border: 1px solid #dee2e6;
            background: white;
        }
        .status-icon {
            width: 100%;
            height: 100%;
            display: block;
            background-color: transparent;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-right: 1px solid #eee;
        }
        .status-icon:last-child { border-right: none; }

        .icon-door-closed  { background-image: url('/resources/static/images/gate/1_door_state/door_closed.png'); }
        .icon-door-open    { background-image: url('/resources/static/images/gate/1_door_state/door_opening.png'); }
        .icon-lock-locked  { background-image: url('/resources/static/images/gate/2_lock_state/door_locking.png'); }
        .icon-lock-unlocked{ background-image: url('/resources/static/images/gate/2_lock_state/door_unlocking.png'); }

        .icon-alarm-error  { background-image: url('/resources/static/images/gate/3_alarm_state/alarm_abnormal.png'); animation: pulse-error 2s infinite; }
        .icon-security-set { background-image: url('/resources/static/images/gate/4_security_state/gate_sec_set.png'); }

        @keyframes pulse-error {
            0%   { transform: scale(0.9); }
            50%  { transform: scale(1.05); }
            100% { transform: scale(0.9); }
        }

        /* ---- グリッドレイアウト ---- */
        .gate-grid {
            display: grid;
            gap: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        /* 16件表示: ゆったり */
        .gate-grid.layout-16 { gap: 5px; }
        .gate-grid.layout-16 .gate-card    { padding: 5px 8px; }
        .gate-grid.layout-16 .gate-info    { min-width: 76px; margin-right: 8px; }
        .gate-grid.layout-16 .gate-number  { font-size: 0.78em; }
        .gate-grid.layout-16 .gate-status-indicator { width: 13px; height: 13px; }

        /* 64件表示: コンパクト */
        .gate-grid.layout-64 { gap: 3px; }
        .gate-grid.layout-64 .gate-card    { padding: 3px 4px; }
        .gate-grid.layout-64 .gate-info    { min-width: 54px; margin-right: 4px; }
        .gate-grid.layout-64 .gate-number  { font-size: 0.65em; }
        .gate-grid.layout-64 .gate-status-indicator { width: 9px; height: 9px; }
        .gate-grid.layout-64 .icon-grid    { gap: 1px; }

        /* ---- コンテンツラッパー ---- */
        .sm-outer {
            display: flex;
            flex-direction: column;
            flex: 1;
            padding: 4px;
            box-sizing: border-box;
            background: var(--td-header-bg);
        }
        .sm-inner {
            flex: 1;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            background: #e0ecf8;
            border: 1px solid var(--td-border);
            border-radius: 8px;
            overflow: hidden;
        }
        .gate-grid-container {
            flex: 1;
            overflow-y: auto;
            padding: 6px;
        }

        /* ---- 凡例フッター ---- */
        .sm-legend {
            flex-shrink: 0;
            background: #ffffff;
            border-top: 1px solid var(--td-border);
            padding: 6px 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            flex-wrap: wrap;
            font-size: 0.78rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #333;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .legend-icon-img {
            width: 16px;
            height: 16px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
        }
        .legend-check { font-size: 0.9em; }
        .legend-divider {
            width: 1px;
            height: 16px;
            background: #ccc;
        }
    </style>
</head>

<body class="td-body">

	<!-- サイドメニュー -->
	<div class="td-overlay" id="menuOverlay"></div>
	<nav class="td-sidemenu" id="sideMenu">
		<div class="td-sidemenu-header">
			<span class="td-sidemenu-title">メニュー</span>
			<button class="td-sidemenu-close" id="menuClose"><i class="fas fa-times"></i></button>
		</div>
		<ul class="td-sidemenu-list">
			<li><a href="/resources/dataMonitor-preview.html"><i class="fas fa-table"></i>データモニター</a></li>
			<li><a href="/resources/statusMonitor-preview.html"><i class="fas fa-th-large"></i>ステータスモニター</a></li>
			<li><a href="/resources/mapMonitor-preview.html"><i class="fas fa-map"></i>マップモニター</a></li>
			<li><a href="/resources/personalList-preview.html"><i class="fas fa-users"></i>個人情報一覧</a></li>
			<li><a href="/resources/personalRegistration-preview.html"><i class="fas fa-user-plus"></i>個人情報登録</a></li>
			<li><a href="/resources/historyReport-preview.html"><i class="fas fa-file-alt"></i>履歴レポート</a></li>
		</ul>
	</nav>

	<!-- ヘッダー -->
	<header class="td-header">
		<!-- ハンバーガー -->
		<button class="td-hamburger" id="menuOpen" title="メニュー">
			<i class="fas fa-bars"></i>
		</button>

		<!-- システムロゴ（TODO: 正式ロゴ画像に差し替え） -->
		<span class="td-logo">プレースホルダー</span>

		<!-- ページ固有コントロール（各ページで上書き） -->
		<div class="td-header-controls">
<div class="td-layout-controls">
            <span>表示:</span>
            <button class="td-layout-btn" data-layout="16">16件</button>
            <button class="td-layout-btn active" data-layout="32">32件</button>
            <button class="td-layout-btn" data-layout="64">64件</button>
        </div>
        <div style="margin-left: auto; display: flex; align-items: center;">
            <div class="dropdown">
                <button class="td-gate-list-btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    ゲートボタン一覧
                </button>
                <ul class="dropdown-menu dropdown-menu-end" id="gateListDropdown" style="min-width: 180px; max-height: 320px; overflow-y: auto;">
                    <!-- JSで生成 -->
                </ul>
            </div>
        </div>
    </div>

		<!-- 設定ボタン -->
		<button class="td-settings-btn" title="設定">
			<i class="fas fa-cog"></i>
		</button>
	</header>

	<!-- メインコンテンツ -->
	<main class="td-main">
		<div class="sm-outer">
            <div class="sm-inner">
                <!-- ゲートカードグリッド -->
                <div class="gate-grid-container">
                    <div class="gate-grid" id="gateGrid">
                        <!-- JavaScriptで動的生成 -->
                    </div>
                </div>
            </div>
        </div>
	</main>

	<!-- ページ固有フッター凡例（各ページで上書き） -->
	<div>
        <div class="sm-legend">
            <div class="legend-item">
                <div class="legend-icon-img icon-door-closed"></div>
                <span>閉扉</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon-img icon-door-open"></div>
                <span>開扉</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon-img icon-lock-locked"></div>
                <span>施錠</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon-img icon-lock-unlocked"></div>
                <span>解錠</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon-img icon-alarm-error" style="animation:none;"></div>
                <span>異常</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon-img icon-security-set"></div>
                <span>警備セット</span>
            </div>
            <div class="legend-divider"></div>
            <div class="legend-item">
                <input type="checkbox" class="status-filter-checkbox" value="normal" checked>
                <div class="legend-dot" style="background:#28a745;"></div>
                <span>正常</span>
            </div>
            <div class="legend-item">
                <input type="checkbox" class="status-filter-checkbox" value="warning" checked>
                <div class="legend-dot" style="background:#e07b00;"></div>
                <span>警告</span>
            </div>
            <div class="legend-item">
                <input type="checkbox" class="status-filter-checkbox" value="error" checked>
                <div class="legend-dot" style="background:#dc3545;"></div>
                <span>異常</span>
            </div>
            <div class="legend-item">
                <input type="checkbox" class="status-filter-checkbox" value="offline" checked>
                <div class="legend-dot" style="background:#6c757d;"></div>
                <span>オフライン</span>
            </div>
        </div>
    </div>

	<!-- フッター -->
	<footer class="td-footer">
		<small>© ART CO., LTD. All Rights Reserved.</small>
	</footer>

	
	<script>
	(function(){
		const overlay = document.getElementById('menuOverlay');
		const menu    = document.getElementById('sideMenu');
		const open    = document.getElementById('menuOpen');
		const close   = document.getElementById('menuClose');
		function show(){ menu.classList.add('open'); overlay.classList.add('open'); }
		function hide(){ menu.classList.remove('open'); overlay.classList.remove('open'); }
		open.addEventListener('click', show);
		close.addEventListener('click', hide);
		overlay.addEventListener('click', hide);
	})();
	</script>
<script type="text/javascript" src="/resources/static/js/statusMonitor.js"></script>
<script>
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                if (!window.statusMonitor) return;

                // フィルターチェックボックス
                document.querySelectorAll('.status-filter-checkbox').forEach(function (cb) {
                    cb.onclick = function () {
                        window.statusMonitor.updateStatusFilters();
                    };
                });

                // ゲートグループドロップダウンを描画
                renderGateGroupDropdown();

                statusMonitor.generateGateGroups();
                statusMonitor.renderGates();
            }, 100);
        });

        function renderGateGroupDropdown() {
            var dropdown = document.getElementById('gateListDropdown');
            if (!dropdown || !window.statusMonitor) return;
            dropdown.innerHTML = '';
            window.statusMonitor.gateGroups.forEach(function (group) {
                var li = document.createElement('li');
                var a = document.createElement('a');
                a.className = 'dropdown-item d-flex align-items-center justify-content-between';
                a.href = '#';
                a.style.fontSize = '0.85rem';

                var label = document.createElement('span');
                label.textContent = group.name;

                var dot = document.createElement('span');
                dot.className = 'gate-group-dot gate-group-' + group.status;

                a.appendChild(label);
                a.appendChild(dot);
                a.addEventListener('click', function (e) {
                    e.preventDefault();
                    window.statusMonitor.selectedGateGroup = group.id;
                    window.statusMonitor.renderGates();
                    // ドロップダウンを閉じる
                    var btn = document.querySelector('.td-gate-list-btn');
                    if (btn) btn.click();
                });
                li.appendChild(a);
                dropdown.appendChild(li);
            });
        }
    </script>
</body>
</html>
